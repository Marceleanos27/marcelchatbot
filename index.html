Zatial mi funguje vsetko uplne aj webhook aj html hosting aj rezervacia ale vadi mi ze ked dam ze rezerovovat tak tam hore vyskoci taka funkcia kde musim pisat veci, ja chcem aby mi to stacilo napisat do toho bota a z neho nejako vlozit do toho scriptu co sa potom posle na n8n

<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>George ‚Äì Realitn√Ω Makl√©r</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    body {
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
      
    }

    #chatbot-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 360px;
      max-height: 500px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: all 0.4s ease;
      z-index: 9999;
      box-sizing: border-box;
    }

    #chatbot-container.closed {
      max-height: 50px;
      width: 220px;
      border-radius: 50px;
    }

    #chatbot-header {
      background: linear-gradient(135deg, #0f7d57, #00b894);
      color: white;
      padding: 7px 20px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1.05em;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #toggle-icon {
      font-size: 1.5em;
      transition: transform 0.3s ease;
    }

    #chatbot-container:not(.closed) #toggle-icon {
      transform: rotate(45deg);
    }

    #chatbot-container.closed #chatbot-body {
      display: none;
    }

    /* MAIN BODY */
    #chatbot-body {
      padding: 16px;
      display: flex;
      flex-direction: column;
      background: #fafafa;
      height: 450px;

      /* new flex properties */
      justify-content: space-between;
      box-sizing: border-box;
    }

    /* CHAT MESSAGES */
    #chat-messages {
      flex-grow: 1;
      overflow-y: auto;
      padding-right: 4px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      /* prevent input area shifting */
      margin-bottom: 8px;
    }

    .message {
      padding: 10px 14px;
      border-radius: 12px;
      max-width: 75%;
      font-size: 0.95em;
      line-height: 1.4;
    }

    .message.user {
      align-self: flex-end;
      background: #d1f7ec;
      color: #1a3e2d;
    }

    .message.bot {
      align-self: flex-start;
      background: #eeeeee;
      color: #333;
    }

    /* INPUT AREA FIXED AT BOTTOM */
    #input-area {
      display: flex;
      flex-direction: column;
      gap: 8px;

      /* Important: no margin top */
      margin-top: 0;

      /* prevent shrinking */
      flex-shrink: 0;
    }

    #user-input {
      width: 100%;
      resize: none;
      height: 60px;
      padding: 10px 12px;
      font-size: 1em;
      border-radius: 10px;
      border: 1.5px solid #ccc;
      font-family: 'Poppins', sans-serif;
      box-sizing: border-box;
    }

    button {
      background: linear-gradient(to right, #00b894, #0f7d57);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 12px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
      box-sizing: border-box;
    }

    button:hover {
      background: linear-gradient(to right, #0f7d57, #00b894);
    }
  </style>
</head>
<body>
  <div id="chatbot-container" class="closed">
    <div id="chatbot-header" onclick="toggleChatbot()">‚ú® George AI <span id="toggle-icon">+</span></div>
    <div id="chatbot-body">
      <div id="chat-messages">
        <div class="message bot">
          <strong>George:</strong> Ahoj! Vol√°m sa George, som tvoj virtu√°lny realitn√Ω makl√©r üè°. Pom√¥≈æem ti s predajom, pren√°jmom alebo k√∫pou nehnuteƒænosti. Ako ti m√¥≈æem pom√¥c≈•?
        </div>
      </div>
      <div id="input-area">
        <textarea id="user-input" placeholder="Nap√≠≈° mi ot√°zku ohƒæadom nehnuteƒænost√≠..."></textarea>
        <button onclick="sendMessage()">Odosla≈• spr√°vu</button>
      </div>
    </div>
  </div>

  

  <script>
    let chatHistory = [
      {
        role: "system",
        content: "Si sk√∫sen√Ω a empatick√Ω slovensk√Ω realitn√Ω makl√©r s viac ne≈æ 10‚Äëroƒçn√Ωmi sk√∫senos≈•ami. Pom√°ha≈° klientom s predajom, k√∫pou aj pren√°jmom nehnuteƒænost√≠, porad√≠≈° s cenotvorbou, v√Ωberom lokality, financovan√≠m, pr√≠pravou dokumentov a cel√Ωm priebehom transakcie. V≈ædy odpoved√°≈° profesion√°lne, jasne a ƒæudsky, pon√∫ka≈° praktick√© rie≈°enia ≈°it√© na mieru a nikdy neodkazuje≈° na to, ≈æe si AI. Pri ka≈ædom dopyte kladie≈° d√¥raz na individu√°lne potreby klienta a zabezpeƒç√≠≈° r√Ωchlu a presn√∫ odpoveƒè. Udr≈æuj odpovede struƒçn√©, zrozumiteƒæn√© a priateƒæsk√©. Ak si mysl√≠≈° ≈æe je spr√°vny ƒças alebo ak dostane≈° spr√°vu nieƒço ako Chcem si rezervova≈• term√≠n tak od ƒçloveka zozbieraj tieto √∫daje: Meno, D√°tum, ƒÜas, Typ slu≈æby."
      }
    ];

    const chatbox = document.getElementById("chat-messages");
    const inputField = document.getElementById("user-input");

    function toggleChatbot() {
      const container = document.getElementById("chatbot-container");
      container.classList.toggle("closed");
      const icon = document.getElementById("toggle-icon");
      icon.innerText = container.classList.contains("closed") ? "+" : "‚àí";
    }

    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function sendMessage() {
      const message = inputField.value.trim();
      if (!message) return;

      appendMessage("Ty", message, "user");
      chatHistory.push({ role: "user", content: message });
      inputField.value = "";
      appendMessage("George", "P√≠≈°em odpoveƒè...", "bot", true);

      try {
        await delay(800);

        const response = await fetch("/api/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ messages: chatHistory })
        });

        if (!response.ok) {
          throw new Error(Chyba ${response.status}: ${response.statusText});
        }

        const data = await response.json();
        const reply = data.choices?.[0]?.message?.content?.trim() || "Prep√°ƒç, neviem na to odpoveda≈•.";

        // Skontroluj, ƒçi AI odpoveƒè naznaƒçuje, ≈æe ide o rezerv√°ciu
const replyLower = reply?.toLowerCase() || "";

const wantsAppointment = message.toLowerCase().includes("rezervova≈•")
  || message.toLowerCase().includes("term√≠n")
  || message.toLowerCase().includes("stretnutie")
  || message.toLowerCase().includes("chcem sa objedna≈•")
  || replyLower.includes("zadaj √∫daje")
  || replyLower.includes("rezervuj")
  || replyLower.includes("zarezervova≈•")
  || replyLower.includes("term√≠n");



if (wantsAppointment) {
  await delay(500); // mal√° pauza
  appendMessage("George", "üóìÔ∏è V poriadku, poƒème si rezervova≈• term√≠n.", "bot");
  await startAppointmentBooking();
}


        chatHistory.push({ role: "assistant", content: reply });
        removeLastBotMessage();
        appendMessage("George", reply, "bot");
      } catch (error) {
        console.error("Chyba:", error);
        removeLastBotMessage();
        appendMessage("George", Ups, nastala chyba: ${error.message}, "bot");
      }
    }

    function appendMessage(sender, message, role, isTemp = false) {
      const msgDiv = document.createElement("div");
      msgDiv.classList.add("message", role);
      if (isTemp) msgDiv.classList.add("temp");

      // Tu sa spracuje **text** na <strong>text</strong>
      const formattedMessage = message.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');

      msgDiv.innerHTML = <strong>${sender}:</strong> ${formattedMessage};
      chatbox.appendChild(msgDiv);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function removeLastBotMessage() {
      const tempMsg = chatbox.querySelector(".bot.temp");
      if (tempMsg) chatbox.removeChild(tempMsg);
    }

async function startAppointmentBooking() {
 console.log("≈†tartujem rezerv√°ciu term√≠nu...");
  const name = prompt("Ak√© je tvoje meno?");
  const date = prompt("Na ktor√Ω d√°tum si chce≈° rezervova≈• term√≠n? (napr. 2025-08-10)");
  const time = prompt("Na ktor√Ω ƒças? (napr. 14:00)");
  const service = prompt("Ak√∫ slu≈æbu chce≈° rezervova≈•?");

  const payload = {
    name: name,
    date: date,
    time: time,
    service: service
  };

  try {
    const res = await fetch("https://marcellehocky.app.n8n.cloud/webhook-test/book-appointment", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    });

    if (res.ok) {
      const data = await res.json();
      appendMessage("George", ‚úÖ Tvoj term√≠n bol √∫spe≈°ne rezervovan√Ω na ${date} o ${time}., "bot");
    } else {
      appendMessage("George", "‚ùå Nepodarilo sa rezervova≈• term√≠n. Sk√∫s to pros√≠m znova.", "bot");
    }
  } catch (err) {
    console.error("Chyba pri odosielan√≠ do n8n:", err);
    appendMessage("George", "‚ùå Nastala technick√° chyba. Sk√∫s to nesk√¥r.", "bot");
  }
}

    
  </script>
</body>
</html>


